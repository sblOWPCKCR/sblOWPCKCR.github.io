var t=Object.defineProperty,e=Object.defineProperties,s=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,r=(e,s,a)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[s]=a,i=(t,e)=>{for(var s in e||(e={}))o.call(e,s)&&r(t,s,e[s]);if(a)for(var s of a(e))n.call(e,s)&&r(t,s,e[s]);return t},l=(t,a)=>e(t,s(a)),c=(t,e,s)=>(r(t,"symbol"!=typeof e?e+"":e,s),s);import{d,c as h,a as u,w as p,v as g,b as f,e as m,t as b,F as y,r as w,f as x,g as v,I as k,h as H,p as S,i as $,j as F,o as P,k as C,l as I,m as A}from"./vendor.aa34f636.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const s of t)if("childList"===s.type)for(const t of s.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerpolicy&&(e.referrerPolicy=t.referrerpolicy),"use-credentials"===t.crossorigin?e.credentials="include":"anonymous"===t.crossorigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();function L(t){return t.startsWith("0x")?t:"0x"+t}async function O(t,e,s){const a=JSON.stringify({network:t,params:e.toString()}),o=localStorage.getItem(a);if(o)return JSON.parse(o);for(let n=0;n<5;++n){s("Querying Etherscan");const o=await fetch(`https://api${"mainnet"==t?"":"-"+t}.etherscan.io/api?`+e),r=await o.json();if(!("message"in r)||r.message.startsWith("OK"))return localStorage.setItem(a,JSON.stringify(r)),r;if(n+1==5)throw`Failed to quest etherscan: ${r.message} - ${r.result}`;const i=5+2**n;s(`Failed to quest etherscan: ${r.message} - ${r.result}; will try again in ${i} seconds; attempts left: ${5-n-1}`),await new Promise(((t,e)=>{setTimeout(t,1e3*i)}))}}var T=(t,e)=>{for(const[s,a]of e)t[s]=a;return t};const N=(t=>(S("data-v-a2258dbc"),t=t(),$(),t))((()=>u("h1",null,"Yield Proposal hash decoder",-1))),E={for:"proposal_hash"},_=F(" Proposal hash "),q={key:0,for:"tx_hash"},B=["href"],j=["value"],J={key:0},D=["for"],U=["href"],M=["id","value"],R=["for"],K=F(" Decoded calldata "),V=["rows","id"],W=["for"],Y=F(" Calldata "),Q=["id","value"],z={class:".logs"};const G=d({data:()=>({proposalHash:location.hash.substring(1),logs:[],txHash:[null,null],calls:[null,null],decoded:{abis:{},contracts:{},calls:{}}}),watch:{proposalHash(t){location.hash="#"+t}},methods:{async decodeHash(t){try{const e=(await O(this.network,new URLSearchParams({module:"logs",action:"getLogs",address:L(this.addressTimelock),topic0:L(this.eventProposed),topic1:L(t)}),(t=>this.logs.push(t)))).result;if(0==e.length)throw"Failed to find Proposal hash";e.length>1&&this.logs.push("Found more than 1 transaction with the same proposal hash; decoding the last one");const s=e[0].transactionHash;null!=this.txHash[0]&&this.proposalHash!=t||(this.txHash=[t,s],await this.decodeTxHash(t,s))}catch(e){this.logs.push(e)}return!1},getEtherscanAddressLink(t){return`https://${"mainnet"==this.network?"":this.network+"."}etherscan.io/address/${L(t)}`},getEtherscanTxLink(t){return`https://${"mainnet"==this.network?"":this.network+"."}etherscan.io/tx/${L(t)}`},getContractName(t){return this.decoded.contracts[t]},getFunctionName(t,e){if(!(t in this.decoded.abis))return"Fetching function name...";const s=this.decoded.abis[t],a=e.slice(0,10),o=s.functions.get(a);return o?o.format(x.full):"Selector not found, that's bad"},getFunctionArguments(t,e){if(!(t in this.decoded.abis))return[["status","Fetching function arguments..."]];const s=this.decoded.abis[t],a=e.slice(0,10),o=s.functions.get(a);if(!o)return[["status","Selector not found, that's bad"]];const n=v.decode([o.format(x.full)],L(e.slice(10)))[0];return o.inputs.map(((t,e)=>[t.format(x.full),n[e]]))},async startFetchingABIs(t){for(const e of t)if(!(e in this.decoded.abis)){const t=(await O(this.network,new URLSearchParams({module:"contract",action:"getsourcecode",address:L(e)}),(t=>this.logs.push(t)))).result[0],s=new k(t.ABI),a=new Map;for(const e in s.functions)a.set(s.getSighash(s.functions[e]),s.functions[e]);this.decoded.contracts[e]=t.ContractName,this.decoded.abis[e]={interface:s,functions:a}}this.logs.push("ABIs fetched")},async decodeTxHash(t,e){const s=(await H(this.network).getTransaction(e)).data,a=v.decode([this.argumentsPropose],L(s.slice(10)))[0];this.calls=[t,a.map((t=>({target:t.target,data:t.data})))],this.startFetchingABIs(new Set(a.map((t=>t.target))))}}});var X=T(d(l(i({},G),{props:{network:{type:String,required:!0},addressTimelock:{type:String,required:!0},eventProposed:{type:String,required:!0},argumentsPropose:{type:String,required:!0}},setup:function(t){return(t,e)=>(P(),h(y,null,[N,u("form",null,[u("label",E,[_,p(u("input",{type:"text",id:"proposal_hash",name:"proposal_hash","onUpdate:modelValue":e[0]||(e[0]=e=>t.proposalHash=e),required:""},null,512),[[g,t.proposalHash]])]),u("button",{onClick:e[1]||(e[1]=f((e=>t.decodeHash(t.proposalHash)),["stop","prevent"]))},"Decode"),t.txHash[0]==t.proposalHash?(P(),h("label",q,[u("a",{href:t.getEtherscanTxLink(t.txHash[1])},"Transaction hash",8,B),u("input",{type:"text",id:"tx_hash",name:"tx_hash",readonly:"",value:t.txHash[1]},null,8,j)])):m("",!0)]),t.calls[0]==t.proposalHash?(P(),h("div",J,[u("h4",null,"Calls: "+b(t.calls[1].length),1),(P(!0),h(y,null,w(t.calls[1],(e=>(P(),h("article",null,[u("form",null,[u("label",{for:e.target},[u("a",{href:t.getEtherscanAddressLink(e.target)},"Target",8,U),u("input",{type:"text",id:e.target,readonly:"",value:`[${t.getContractName(e.target)}] ${e.target}`},null,8,M)],8,D),u("label",{for:"decoded"+e.data},[K,u("textarea",{rows:t.getFunctionArguments(e.target,e.data).length+3,readonly:"",id:"decoded"+e.data},b(t.getFunctionName(e.target,e.data))+"\n\n"+b(t.getFunctionArguments(e.target,e.data).map((t=>`${t[0]} = ${t[1]}`)).join(";\n"))+"\n            ",9,V)],8,R),u("label",{for:e.data},[Y,u("input",{type:"text",id:e.data,readonly:"",value:e.data},null,8,Q)],8,W)])])))),256))])):m("",!0),u("small",z,b(t.logs.length?t.logs[t.logs.length-1]:""),1)],64))}})),[["__scopeId","data-v-a2258dbc"]]);const Z=(t=>(S("data-v-7f07bb31"),t=t(),$(),t))((()=>u("h1",null,"Yield Batch decoder",-1))),tt={for:"tx_hash"},et=F(" Transaction hash "),st={key:0},at=["rows"],ot={class:".logs"};const nt=d({data:()=>({logs:[],txHash:location.hash.substring(1),calls:[null,null],decoded:{abis:{},contracts:{},calls:{}}}),watch:{txHash(t){location.hash="#"+t}},methods:{getFunctionName(t,e){if(!(t in this.decoded.abis))return"Fetching function name...";const s=this.decoded.abis[t],a=e.slice(0,10),o=s.functions.get(a);return o?o.format(x.full):"Selector not found, that's bad"},getFunctionArguments(t,e){if(!(t in this.decoded.abis))return[["status","Fetching function arguments..."]];const s=this.decoded.abis[t],a=e.slice(0,10),o=s.functions.get(a);if(!o)return[["status","Selector not found, that's bad"]];const n=v.decode([o.format(x.full)],L(e.slice(10)))[0];return o.inputs.map(((t,e)=>[t.format(x.full),n[e]]))},async getABI(t){if(!(t in this.decoded.abis)){const e=(await O(this.network,new URLSearchParams({module:"contract",action:"getsourcecode",address:L(t)}),(t=>this.logs.push(t)))).result[0],s=new k(e.ABI),a=new Map;for(const t in s.functions)a.set(s.getSighash(s.functions[t]),s.functions[t]);this.decoded.contracts[t]=e.ContractName,this.decoded.abis[t]={interface:s,functions:a}}return this.decoded.abis[t]},getFunction(t,e){const s=e.slice(0,10),a=t.functions.get(s);if(!a)throw new Error(`Can't find selector ${s} in function ${t}`);return[a,L(e.slice(10))]},log(t){this.logs.push(t)},async resolveCall(t){const e=await this.getABI(t.to),[s,a]=this.getFunction(e,t.calldata);let o=v.decode(s.inputs.map((t=>t.format())),a);C(t.to)==C(this.addressLadle)&&"batch"==s.name?(o=[o[0].map((e=>new rt(t.to,e)))],await Promise.all(o[0].map((t=>this.resolveCall(t))))):C(t.to)==C(this.addressLadle)&&"route"==s.name?(o=[new rt(o[0],o[1])],await this.resolveCall(o[0])):o=o.map((t=>t.toString())),t.resolve(s.name,o)},async decodeTxHash(t){const e=await H(this.network).getTransaction(t);if(e.data,!e.to)return void this.log(`Transaction without address: ${e}`);const s=new rt(e.to,e.data);this.log(`call: ${s}`),await this.resolveCall(s),this.calls=[t,s]},getCallsJson(){return JSON.stringify(this.calls[1],((t,e)=>e instanceof rt?e.toPrettyJson():e),2)}}});class rt{constructor(t,e){c(this,"method"),c(this,"arguments",[]),this.to=t,this.calldata=e}resolve(t,e){this.method=t,this.arguments=e}toPrettyJson(){return{function:`${this.method} [${this.to}]`,arguments:this.arguments}}}var it=T(d(l(i({},nt),{props:{network:{type:String,required:!0},addressLadle:{type:String,required:!0}},setup:function(t){return(t,e)=>(P(),h(y,null,[Z,u("form",null,[u("label",tt,[et,p(u("input",{type:"text",id:"tx_hash",name:"tx_hash","onUpdate:modelValue":e[0]||(e[0]=e=>t.txHash=e)},null,512),[[g,t.txHash]])]),u("button",{onClick:e[1]||(e[1]=f((e=>t.decodeTxHash(t.txHash)),["stop","prevent"]))},"Decode")]),t.calls[0]==t.txHash?(P(),h("div",st,[u("textarea",{rows:t.getCallsJson().match(/\n/g).length+3,readonly:""},b(t.getCallsJson())+"\n    ",9,at)])):m("",!0),u("small",ot,b(t.logs.length?t.logs[t.logs.length-1]:""),1)],64))}})),[["__scopeId","data-v-7f07bb31"]]);const lt=d({props:{batch:{type:Boolean,required:!0}},setup:t=>(e,s)=>(P(),h(y,null,[t.batch?m("",!0):(P(),I(X,{key:0,network:"mainnet","event-proposed":"0x2de9aefe888ee33e88ff8f7de007bdda112b7b6a4d0b1cd88690e805920d4091","address-timelock":"0xA5E64f55f1d7244475Ee3842E06295c1973482eD","arguments-propose":"tuple(address target, bytes data)[]"})),t.batch?(P(),I(it,{key:1,network:"kovan","address-ladle":"0x5840069b175d3eea154c58b065edc06095bb9217"})):m("",!0)],64))});document.getElementById("app")&&A(lt,{batch:!1}).mount("#app"),document.getElementById("batch-app")&&A(lt,{batch:!0}).mount("#batch-app");
