var t=Object.defineProperty,e=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,n=(e,a,s)=>a in e?t(e,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[a]=s;import{d as i,c as l,a as c,w as d,v as h,b as u,e as p,t as g,F as f,r as m,f as y,g as w,I as b,p as x,h as k,i as v,o as H,j as S,k as P}from"./vendor.1a214a54.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const a of t)if("childList"===a.type)for(const t of a.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerpolicy&&(e.referrerPolicy=t.referrerpolicy),"use-credentials"===t.crossorigin?e.credentials="include":"anonymous"===t.crossorigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();var $=(t,e)=>{for(const[a,s]of e)t[a]=s;return t};const F=(t=>(x("data-v-348599ea"),t=t(),k(),t))((()=>c("h1",null,"Yield Proposal hash decoder",-1))),O={for:"proposal_hash"},L=v(" Proposal hash "),A={key:0,for:"tx_hash"},N=["href"],j=["value"],E={key:0},I=["for"],T=["href"],_=["id","value"],q=["for"],C=v(" Decoded calldata "),B=["rows","id"],D=["for"],U=v(" Calldata "),J=["id","value"],R={class:".logs"};function K(t){return t.startsWith("0x")?t:"0x"+t}async function M(t,e,a){const s=JSON.stringify({network:t,params:e.toString()}),r=localStorage.getItem(s);if(r)return JSON.parse(r);for(let o=0;o<5;++o){a("Querying Etherscan");const r=await fetch(`https://api${"mainnet"==t?"":"-"+t}.etherscan.io/api?`+e),n=await r.json();if(!("message"in n)||n.message.startsWith("OK"))return localStorage.setItem(s,JSON.stringify(n)),n;if(o+1==5)throw`Failed to quest etherscan: ${n.message} - ${n.result}`;const i=2**o;a(`Failed to quest etherscan: ${n.message} - ${n.result}; will try again in ${i} seconds; attempts left: ${5-o-1}`),await new Promise(((t,e)=>{setTimeout(t,1e3*i)}))}}const W=i({data:()=>({proposalHash:location.hash.substring(1),logs:[],txHash:[null,null],calls:[null,null],decoded:{abis:{},contracts:{},calls:{}}}),watch:{proposalHash(t){location.hash="#"+t}},methods:{async decodeHash(t){try{const e=(await M(this.network,new URLSearchParams({module:"logs",action:"getLogs",address:K(this.addressTimelock),topic0:K(this.eventProposed),topic1:K(t)}),(t=>this.logs.push(t)))).result;if(0==e.length)throw"Failed to find Proposal hash";e.length>1&&this.logs.push("Found more than 1 transaction with the same proposal hash; decoding the last one");const a=e[0].transactionHash;null!=this.txHash[0]&&this.proposalHash!=t||(this.txHash=[t,a],await this.decodeTxHash(t,a))}catch(e){this.logs.push(e)}return!1},getEtherscanAddressLink(t){return`https://${"mainnet"==this.network?"":this.network+"."}etherscan.io/address/${K(t)}`},getEtherscanTxLink(t){return`https://${"mainnet"==this.network?"":this.network+"."}etherscan.io/tx/${K(t)}`},getContractName(t){return this.decoded.contracts[t]},getFunctionName(t,e){if(!(t in this.decoded.abis))return"Fetching function name...";const a=this.decoded.abis[t],s=e.slice(0,10),r=a.functions.get(s);return r?r.format(y.full):"Selector not found, that's bad"},getFunctionArguments(t,e){if(!(t in this.decoded.abis))return[["status","Fetching function arguments..."]];const a=this.decoded.abis[t],s=e.slice(0,10),r=a.functions.get(s);if(!r)return[["status","Selector not found, that's bad"]];const o=w.decode([r.format(y.full)],K(e.slice(10)))[0];return r.inputs.map(((t,e)=>[t.format(y.full),o[e]]))},async startFetchingABIs(t){for(const e of t)if(!(e in this.decoded.abis)){const t=(await M(this.network,new URLSearchParams({module:"contract",action:"getsourcecode",address:K(e)}),(t=>this.logs.push(t)))).result[0],a=new b(t.ABI),s=new Map;for(const e in a.functions)s.set(a.getSighash(a.functions[e]),a.functions[e]);this.decoded.contracts[e]=t.ContractName,this.decoded.abis[e]={interface:a,functions:s}}this.logs.push("ABIs fetched")},async decodeTxHash(t,e){const a=(await M(this.network,new URLSearchParams({module:"proxy",action:"eth_getTransactionByHash",txhash:K(e)}),(t=>this.logs.push(t)))).result.input,s=w.decode([this.argumentsPropose],K(a.slice(10)))[0];this.calls=[t,s.map((t=>({target:t.target,data:t.data})))],this.startFetchingABIs(new Set(s.map((t=>t.target))))}}});var Q,V=$(i((Q=((t,e)=>{for(var a in e||(e={}))r.call(e,a)&&n(t,a,e[a]);if(s)for(var a of s(e))o.call(e,a)&&n(t,a,e[a]);return t})({},W),e(Q,a({props:{network:{type:String,required:!0},addressTimelock:{type:String,required:!0},eventProposed:{type:String,required:!0},argumentsPropose:{type:String,required:!0}},setup:function(t){return(t,e)=>(H(),l(f,null,[F,c("form",null,[c("label",O,[L,d(c("input",{type:"text",id:"proposal_hash",name:"proposal_hash","onUpdate:modelValue":e[0]||(e[0]=e=>t.proposalHash=e),required:""},null,512),[[h,t.proposalHash]])]),c("button",{onClick:e[1]||(e[1]=u((e=>t.decodeHash(t.proposalHash)),["stop","prevent"]))},"Decode"),t.txHash[0]==t.proposalHash?(H(),l("label",A,[c("a",{href:t.getEtherscanTxLink(t.txHash[1])},"Transaction hash",8,N),c("input",{type:"text",id:"tx_hash",name:"tx_hash",readonly:"",value:t.txHash[1]},null,8,j)])):p("",!0)]),t.calls[0]==t.proposalHash?(H(),l("div",E,[c("h4",null,"Calls: "+g(t.calls[1].length),1),(H(!0),l(f,null,m(t.calls[1],(e=>(H(),l("article",null,[c("form",null,[c("label",{for:e.target},[c("a",{href:t.getEtherscanAddressLink(e.target)},"Target",8,T),c("input",{type:"text",id:e.target,readonly:"",value:`[${t.getContractName(e.target)}] ${e.target}`},null,8,_)],8,I),c("label",{for:"decoded"+e.data},[C,c("textarea",{rows:t.getFunctionArguments(e.target,e.data).length+3,readonly:"",id:"decoded"+e.data},g(t.getFunctionName(e.target,e.data))+"\n\n"+g(t.getFunctionArguments(e.target,e.data).map((t=>`${t[0]} = ${t[1]}`)).join(";\n"))+"\n            ",9,B)],8,q),c("label",{for:e.data},[U,c("input",{type:"text",id:e.data,readonly:"",value:e.data},null,8,J)],8,D)])])))),256))])):p("",!0),c("small",R,g(t.logs.length?t.logs[t.logs.length-1]:""),1)],64))}})))),[["__scopeId","data-v-348599ea"]]);P(i({setup:t=>(t,e)=>(H(),S(V,{network:"mainnet","event-proposed":"0x2de9aefe888ee33e88ff8f7de007bdda112b7b6a4d0b1cd88690e805920d4091","address-timelock":"0xA5E64f55f1d7244475Ee3842E06295c1973482eD","arguments-propose":"tuple(address target, bytes data)[]"}))})).mount("#app");
